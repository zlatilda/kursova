{% extends 'base.html' %}
{% load i18n %}
{% load poll_tags %}
{% block body %}
<div class="poll_style" style="width: 60%;margin: 0 auto; padding: 3%;">
	<h4 class="title">{{ poll.title }}</h4>
    {% if  poll.get_vote_count > 0%}
        <ul style="list-style: none;">
            {% for i in items %}
            <li>{{ i.value }}: <b>{% filter floatformat %}{% percentage poll i %}{% endfilter %}%</b><br>
                <div style="background: #D1B692; border: 1px solid #AD8346; height: 20px; width: {% percentage poll i %}%;"></div>
            </li>
            {% endfor %}
        </ul>
        <canvas id="pie-chart" width="800" height="450"></canvas>
    {% else %}
          <p>Nobody has voted here yet :(  Log in and be first to vote!</p>
    {% endif %}

	<p>{% trans "Total votes" %}: <b>{{ poll.get_vote_count }}</b></p><br>
</div>
<div class="col-12" id="comments" style="width: 50%;margin: 0 auto; padding-left: 10%; padding-right: 10%;">
{{ comments.count }} comment{{ comments|pluralize }}
    <br>
    <form method="post">
        {% csrf_token %}
        {% if request.user.is_authenticated %}
            {{ comment_form.as_p }}
            <input type="submit" value="Submit" class="btn btn-outline-success">
        {% else %}
            <p style="color:red"> You're not authenticated to write a comment<p>
        {% endif %}
    </form>
{% if comments %}
    {% for comment in comments %}
        <div>
            {% if request.user.is_authenticated %}
                <div style="color: midnightblue;">by <a href="{% url 'kursova:get_user_profile' comment.user.username %}"><b>{{ comment.user}}</b></a> <span style="font-size: 0.75em; float:right;">{{ comment.timestamp }}</span></div>
            {% else %}
                <div style="color: midnightblue;">by <b>{{ comment.user}}</b> <span style="font-size: 0.75em; float:right;">{{ comment.timestamp }}</span></div>
            {% endif %}
            <p class="mb-0">{{ comment.content }}</p>
        </div>
        <hr>
    {% endfor %}

{% else %}
    <div class="col-12" style="padding-right: 20%; padding-left: 20%;"><p>No comments.</p></div>
{% endif %}
</div>
    <script>
        new Chart(document.getElementById("pie-chart"), {
    type: 'pie',
    data: {
      labels: ["Men", "Women", "Battle helicopter"],
      datasets: [{
        label: "Population (millions)",
        backgroundColor: ["#3e95cd", "#8e5ea2","#3cba9f"],
        data: {{ poll.sexes }}
      }]
    },
    options: {
      title: {
        display: true,
        text: 'Sexes among people who voted'
      }
    }
});
    </script>
{% endblock %}




